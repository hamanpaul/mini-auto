//*----------------------------------------------------------------------------
//* ゅンW			   : search.c
//* \啻yz		   : 矗ㄑS恁\嗒氦害sdтㄧ计
//* @    		   : s@
//* ━			   : 1.0
//* 廿撙榇痢B啥	   : 2004/07/17 09:48
//* 程癍拽铯榇痢B啥 : 
//* 拽锃歃]		   : 
//*----------------------------------------------------------------------------

//*------------------------------ include file --------------------------------
#include <string.h>
#include	"ucos_ii.h"
#include	"search.h"
//*--------------------- Constants & Variable definition ----------------------
//*----------------------------------------------------------------------------
//* ㄧ计W嘿 : MemSearch
//* \啻yz : bwjp氦害s跋办dт计沮A赣ㄧ计iHdтヴN摸杭凭
//* Jf把计 :       <pvMem>[in] Vw氦害s跋办w
//*			 :  <u32MemSize>[in] Q浪沥害s跋办氦jp
//*			 :     <u32Data>[in] Q浪联杭凭
//*			 : <u32DataSize>[in] Q浪联杭凭冥jp]BYTE^
//* Xf把计 : т飓h穰^旄mwA_h穰^痊NULL
//*----------------------------------------------------------------------------
void *MemSearch(void *pvMem, INT32U u32MemSize, INT32U u32Data, INT32U u32DataSize)
{
	const INT8U		*__pubAddr = pvMem;	
	INT8S 			*__pbData = (INT8S *)&u32Data;
	INT32S 			i;
	BOOLEAN			__blIsMatch;
	
	do{
		__pubAddr = (INT8U*)MemChr((INT8S*)__pubAddr, *__pbData, ((INT8U *)pvMem + u32MemSize) - __pubAddr);
		if(__pubAddr != NULL)
		{
			__blIsMatch = TRUE;
			for(i=1; i<u32DataSize; i++)
			{
				if(*(__pubAddr + i) != *(__pbData + i))
				{
					__blIsMatch = OS_FALSE;
					break;
				}
			}
		
			if(__blIsMatch)
				return (void *)__pubAddr;
		
			__pubAddr++;	
		}
		else
			break;		
	}while(TRUE);
	
	return NULL;
}

//*----------------------------------------------------------------------------
//* ㄧ计W嘿 : MemChr
//* \啻yz : bw氦害s跋办dтr才
//* Jf把计 :      <pbMem>[in] Vw氦害s跋办w
//*			 :      <bBYTE>[in] Q浪联害r才
//*			 : <u32MemSize>[in] ずsjp
//* Xf把计 : 穰^т飒汗昊讦旄m
//*----------------------------------------------------------------------------
INT8S *MemChr(INT8S *pbMem, INT8S bBYTE, INT32U u32MemSize)
{
	INT8S		*__pbNext = pbMem;
	INT32S		i;

	for(i=0; i<u32MemSize; i++)
	{
		if(*(__pbNext+i) == bBYTE)
			return (__pbNext + i);
	}
	
	return NULL;
}

//*----------------------------------------------------------------------------
//* ㄧ计W嘿 : memstr
//* \啻yz : bw氦害s跋办dтr才
//* Jf把计 :     <pbMem>[in] Vw氦害s跋办w
//*			 :     <pbStr>[in] Q浪联害r才
//*			 : <ulStrSize>[in] Q浪联害r才辘jp
//*			 : <ulMemSize>[in] ずsjp
//* Xf把计 : т飓h穰^TRUEA_h穰^FALSE
//*----------------------------------------------------------------------------
BOOLEAN memstr(INT8S *pbMem, INT8S *pbStr, INT32U u32StrSize, INT32U u32MemSize)
{
	INT8S *__pbNext = pbMem;
	
	__pbNext = MemChr(__pbNext, (INT8S)pbStr[0], u32MemSize);
	while(__pbNext != NULL)
	{
		if(__pbNext != NULL)
		{
			if(strncmp(__pbNext, pbStr, u32StrSize) == 0)
				return TRUE;
			
			__pbNext += 1;
			__pbNext = MemChr(__pbNext, (INT8S)pbStr[0], (pbMem + u32MemSize) - __pbNext);
		}
	}
		
	return FALSE;
}

//*----------------------------------------------------------------------------
//* ㄧ计W嘿 : memstrExt
//* \啻yz : bw氦害s跋办dтr才
//* Jf把计 :     <pbMem>[in] Vw氦害s跋办w
//*			 :     <pbStr>[in] Q浪联害r才
//*			 : <ulStrSize>[in] Q浪联害r才辘jp
//*			 : <ulMemSize>[in] ずsjp
//* Xf把计 : т飒穰^r才戛姚b害旄mwA_h穰^NULL
//*----------------------------------------------------------------------------
INT8S *memstrExt(INT8S *pbMem, INT8S *pbStr, INT32U u32StrSize, INT32U u32MemSize)
{
	INT8S *__pbNext = pbMem;
	
	__pbNext = MemChr(__pbNext, (INT8S)pbStr[0], u32MemSize);
	while(__pbNext != NULL)
	{
		if(__pbNext != NULL)
		{
			if(strncmp(__pbNext, pbStr, u32StrSize) == 0)
				return __pbNext;
			
			__pbNext += 1;
			__pbNext = MemChr(__pbNext, (INT8S)pbStr[0], (pbMem + u32MemSize) - __pbNext);
		}
	}
		
	return NULL;
}

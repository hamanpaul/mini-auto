# 後端 API 測試檔案分析

本文件旨在分析 `test/unit/api/` 目錄下的主要 Python 測試檔案：`test_api.py` 和 `test_main.py`，並闡明它們各自的用途和區別。

## 檔案用途分析

### 1. `test_api.py`

*   **核心焦點**：此檔案是針對 `src/py_rear/apis/vehicle_api.py` 中定義的核心 API 端點的**完整單元測試套件**。
*   **測試範圍**：涵蓋了所有與車輛核心功能直接相關的 API，確保其業務邏輯的正確性。
    *   `/api/sync`：測試與 Arduino 的數據同步功能，包括有和沒有熱成像數據的場景。
    *   `/api/register_camera`：驗證 ESP32-S3 攝影機 IP 的註冊功能。
    *   `/api/manual_control`：測試手動控制指令的設定與更新。
    *   `/api/set_control_mode`：測試不同控制模式（手動、避障等）的切換。
    *   `/api/latest_data`：驗證獲取最新車輛狀態和指令的端點，並確保數據在其他 API 被呼叫後能被正確更新。
*   **測試方法**：使用 `fastapi.testclient.TestClient` 模擬 HTTP 請求，並對每個端點的回應狀態碼和 JSON 內容進行詳細斷言，以確保其行為符合預期。



### 2. `test_main.py`

*   **核心焦點**：此檔案專注於測試 FastAPI **應用程式的核心機制**，也就是 `src/py_rear/main.py` 的功能。
*   **測試範圍**：
    *   **根路徑 (`/`)**：驗證應用程式的根 URL 是否返回預期的歡迎訊息。
    *   **動態 API 載入機制**：這是此檔案最關鍵的測試。根據專案架構，`main.py` 會動態掃描 `apis/` 目錄並載入所有路由。此測試透過呼叫定義在不同 API 模組（如 `example.py`, `movement.py`）中的端點，來驗證這個動態載入和路由整合的機制是否正常運作。
*   **測試方法**：測試的目標並非單一 API 的業務邏輯，而是應用程式整體的**啟動、路由配置和模組化載入**等框架層面的功能。

## 主要區別總結

| 檔案 | 測試目標 | 測試範圍 | 複雜度 |
| :--- | :--- | :--- | :--- |
| **`test_api.py`** | **業務邏輯** | 針對 `vehicle_api.py` 的所有核心功能 | 高 |

| **`test_main.py`** | **框架功能** | 應用程式啟動、動態路由載入 | 中 |

簡單來說：
- `test_api.py` 確保**車輛控制功能**正確無誤。
- `test_main.py` 確保**應用程式的基礎架構**（特別是路由）穩固可靠。

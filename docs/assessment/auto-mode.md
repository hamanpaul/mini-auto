# Autonomous Mode 行為模式探討

本文檔記錄了為 mini-auto 專案設計 `AUTONOMOUS` (自動) 模式的討論過程，特別是關於如何結合「熱源追蹤」與「障礙物閃避」兩種行為。

## 核心挑戰

如何在追蹤熱源的過程中，如果路徑被障礙物阻擋，能夠智慧地處理衝突，而不是陷入「前進-後退」的死循環。需要引入「巡場」概念，即在放棄被阻擋的目標後，能繼續尋找新目標，並在一段時間後重新評估之前的區域。

## 方案一：狀態機與忽略列表 (初始複雜方案)

- **核心思想**: 引入狀態機（巡航、追蹤、避障）和一個「忽略列表」來記錄被障礙物阻擋的熱源位置。
- **優點**: 功能完善，邏輯嚴謹。
- **缺點**: 實現較為複雜，改動較大。

## 方案二：三種簡化替代方案

為了尋求改動幅度更小的作法，提出了以下三種替代方案：

| 方案 | 改動幅度 | 智慧程度 | 核心機制 |
| :--- | :--- | :--- | :--- |
| **1. 純反應式切換** | **極小** | 低 | `if obstacle then avoid else track` |
| **2. 計時器鎖定** | 小 | 中 | 避障時，暫停追蹤 N 秒 |
| **3. 目標座標偏移** | 中 | 高 | 目標被擋住時，試圖繞行 |

**結論**: 方案二「計時器鎖定」在改動幅度與智慧程度上取得了最好的平衡。

## 方案三：最終整合方案 (結合目標偏移與忽略列表)

此方案是針對使用者提出的「巡場」概念，對方案二和三進行的最終整合與昇華。

### 1. 忽略列表的移除與更新機制

為了讓忽略列表（地圖）保持動態更新，引入移除機制：

- **基於時間的移除 (Time-based Decay)**: 為被忽略的點設定「保質期」，過期後自動移除。這能應對動態障礙物，並實現「巡場」後重新評估。
- **基於空間的移除 (Space-based Invalidation)**: 車輛移動到全新區域後，清空列表。
- **基於觀測的更新 (Observation-based Update)**: 在新視角下未觀測到舊障礙物，則將其移除。

我們選用最簡單有效的「基於時間的移除」機制。

### 2. 完整決策流程

1.  **初始化**: 維護一個全域的 `obstacle_map = []`，記錄被忽略的障礙物方向和過期時間 `ignore_until`。
2.  **清理地圖**: 每次決策前，先從 `obstacle_map` 中移除已過期的項目。
3.  **感測器融合**: 獲取熱源的 `target_angle` 和即時視覺的 `obstacle_angle`。
4.  **決策邏輯**:
    - **檢查地圖**: 如果 `target_angle` 指向一個已知的、未過期的障礙物，則執行**自由巡航**（如旋轉）尋找新目標。
    - **檢查即時觀測**: 如果 `target_angle` 與新發現的 `obstacle_angle` 衝突：
        - 將新障礙物及其過期時間加入 `obstacle_map`。
        - 執行**目標座標偏移**邏輯，計算臨時繞行角度並移動。
    - **無衝突**: 直奔 `target_angle`。
    - **無目標**: 執行**自由巡航**。

### 結論

此整合方案建立了一個智慧的自主系統：
- **記憶性**: 記得障礙物位置，避免重複挑戰。
- **巡場能力**: 記憶有時效性，允許重新探索，能發現後續發生的火災。
- **流暢性**: 行為是「繞行」，而非生硬的「前進/後退」。

此方案邏輯上最完善，且不需修改硬體或前端，是未來實作 `AUTONOMOUS` 模式的最佳藍圖。

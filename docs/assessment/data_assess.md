## 後端數據管理實現程度評估

目前 Miniauto 專案的 Python FastAPI 後端在數據管理方面的實現是**非常基礎的，主要依賴於記憶體中的全域變數來儲存和管理數據**。這意味著數據是暫時性的，當後端服務重啟時，所有儲存在記憶體中的數據都將會丟失。

### 已實現部分：

1.  **即時數據儲存 (記憶體中)**：
    *   **最新 ESP32 數據** (`latest_arduino_data`)：透過 `/api/sync` 端點接收到的最新車輛狀態數據（包括狀態字節 `s`、電壓 `v`、熱成像數據 `t`、ESP32 IP `i`、超音波距離 `u`）會儲存在一個全域字典中。
    *   **最新發送指令** (`latest_command_sent`)：後端生成並發送給 ESP32 的最新控制指令也會儲存在一個全域字典中。
    *   **ESP32-CAM IP 地址** (`latest_esp32_cam_ip`)：透過 `/api/register_camera` 註冊的 ESP32-CAM IP 地址儲存在一個全域字串變數中。
    *   **控制模式** (`current_control_mode`)：當前車輛的控制模式（手動、避障、自主）儲存在一個全域枚舉變數中。
    *   **手動控制指令** (`current_manual_motor_speed`, `current_manual_direction_angle`, `current_manual_servo_angle`, `current_manual_command_byte`)：手動模式下的控制指令儲存在各自的全域變數中。
    *   **熱成像分析結果** (`latest_thermal_analysis_results`)：對最新熱成像數據的分析結果儲存在一個全域字典中。
    *   **視覺分析結果** (`_latest_visual_analysis_results` within `CameraStreamProcessor`)：最新的視覺分析結果儲存在 `CameraStreamProcessor` 實例的成員變數中。
    *   **後端日誌** (`backend_log_buffer`)：後端服務的運行日誌儲存在一個循環緩衝區（列表）中，限制了條目數量以防止記憶體過度使用。

2.  **數據獲取 API**：
    *   `/api/latest_data` (GET): 允許外部客戶端獲取上述大部分最新儲存的數據。
    *   `/api/logs` (GET): 允許獲取後端日誌。

### 未實現部分：

1.  **數據持久化**：
    *   目前沒有任何機制將數據儲存到磁碟（例如，資料庫、檔案系統）。這意味著每次後端服務重啟，所有歷史數據和最新狀態都會丟失。
2.  **歷史數據管理**：
    *   沒有儲存歷史數據的功能。只能訪問最新的數據點，無法追溯車輛過去的狀態、指令或分析結果。
3.  **數據查詢與分析**：
    *   缺乏複雜的數據查詢能力。只能透過特定的 API 端點獲取預定義的最新數據，無法進行時間序列分析、趨勢分析或自定義數據報告。
4.  **數據完整性與一致性**：
    *   由於數據儲存在全域變數中，缺乏事務性保證和數據完整性約束。
5.  **可擴展性**：
    *   當數據量增加時，基於記憶體的儲存方式無法擴展。

### 總結：

後端目前的數據管理是**臨時性且非持久化的**。它能夠滿足即時通訊和控制的需求，但對於需要追溯歷史、進行複雜分析或在服務重啟後保留數據的應用場景來說，是遠遠不足的。

要實現更健壯的數據管理，需要引入一個持久化儲存解決方案（如關係型資料庫 SQLite, PostgreSQL 或 NoSQL 資料庫 MongoDB），並設計相應的數據模型和數據訪問層。
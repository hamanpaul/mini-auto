# Miniauto 專案開發歷程

本文件記錄了 Miniauto 專案從初期建構到當前狀態的主要開發階段和重大架構變更。

## 階段一：初期建構與核心 API (2025年7月中旬)

*   **核心架構**: 專案初期採用 **Arduino UNO + ESP-01S** 的硬體組合，由 UNO 透過 AT 命令直接與後端進行 Wi-Fi 通訊。
*   **後端建置**: 使用 Python FastAPI 框架建立了後端服務，並定義了第一版的核心 API，包括：
    *   `/api/sync`: 用於車輛與後端之間的數據同步。
    *   `/api/manual_control`: 用於接收來自客戶端的手動控制指令。
    *   `/api/latest_data`: 用於查詢車輛的最新狀態。
*   **主要挑戰**: Arduino UNO 的記憶體 (SRAM) 資源非常有限，在處理網路通訊、JSON 解析和即時控制任務時捉襟見肘，導致了對記憶體的極端優化，例如手動拼接 JSON 字串。

## 階段二：GUI 開發與攝影機整合 (2025年7月下旬)

*   **前端介面**: 開發了基於 Vue.js 的前端網頁介面 (`index.html`)，提供了對車輛的基本控制和狀態顯示功能。
*   **攝影機整合**: 引入了 ESP32-CAM 作為獨立的視覺模組。後端增加了 `CameraStreamProcessor` 服務，負責從 ESP32-CAM 拉取 MJPEG 影像串流，並透過 `/api/camera/stream` API 將其代理轉發給前端。
*   **架構問題**: 此階段暴露了 UNO 直接處理網路的脆弱性，網路延遲會直接影響馬達控制的即時性。

## 階段三：重大架構重構 - 網路任務轉移 (2025年7月27日左右)

這是專案至今最重要的一次變革，為了解決 UNO 的性能瓶頸和網路通訊的不穩定性，進行了徹底的架構重構。

*   **核心變更**: 將**所有網路通訊任務從 Arduino UNO 轉移至 ESP32-CAM**。
*   **新架構**:
    *   **Arduino UNO**: 回歸其核心職責—**即時硬體控制器**。它不再處理任何 Wi-Fi 或 HTTP 邏輯，僅透過 **I2C** 與 ESP32 進行高效的數據交換。
    *   **ESP32-CAM**: 角色升級為**視覺模組兼網路代理 (Network Agent)**。它負責處理 Wi-Fi 連線、HTTP 通訊，並作為 UNO 的協同處理器。
    *   **通訊流程**: `GUI <-> 後端 <-> ESP32 <-> UNO`。
*   **相關文件**: 這次重構在 `docs/architecture_summary.md`, `docs/HardwareSpecification_V3.md`, 和 `docs/Software_Requirements_v2.md` 中有詳細的記錄。
*   **程式碼影響**: `arduino_uno.ino` 和 `esp32_cam.ino` 的程式碼都進行了大規模的修改。

## 階段四：服務發現與穩定性強化 (2025年7月28日)

*   **動態服務發現**: 為了擺脫硬編碼 IP 的限制，後端增加了 **UDP 廣播**功能 (`broadcast_server_ip.py`)。ESP32 啟動後會自動在區域網內聆聽此廣播，從而動態發現後端伺服器的 IP 位址。
*   **I2C 通訊優化**: 針對 UNO 的 I2C 緩衝區限制進行了優化，確保熱成像等大數據量的穩定傳輸。

## 階段五：功能迭代與錯誤修正 (2025年7月29日)

在新的穩定架構基礎上，開發工作進入功能迭代和體驗優化的階段。

*   **韌體功能**:
    *   實作低電量 LED 指示燈。
    *   重構馬達控制邏輯，提升運動平順度。
    *   強化熱像儀數據處理與警報機制。
*   **後端與 GUI**:
    *   修正了 GUI 的顯示問題。
    *   增加了動態 GUI 顯示，能根據後端狀態變化更新介面。
*   **開發流程**: 開始採用更規範的 Pull Request 和分支管理流程 (`bugfix/...`, `feat/...`) 進行協作。

## 階段六：自主能力強化與外部整合 (2025年7月30日 - 8月1日)

此階段專注於提升車輛的自主決策能力，並整合外部通知服務，大幅增強了系統的實用性與互動性。

*   **核心功能強化**:
    *   **運動控制優化**: 全面重構了馬達控制演算法，顯著提升了車輛移動的平順度與精準度。
    *   **自主駕駛與避障**: 強化了自動駕駛模式，並改善了障礙物閃避的邏輯，使車輛在複雜環境中能更可靠地導航。
*   **外部服務整合**:
    *   **LINE 通知**: 整合了 LINE Notify 功能，當系統偵測到火災等緊急事件時，能即時將警報訊息推播給指定用戶。
*   **開發與文件流程**:
    *   **標準化分支管理**: 確立了以 `feat/` 和 `bugfix/` 為前綴的分支命名慣例，並透過 Pull Request 進行程式碼審查與合併。
    *   **文件重構**: 對核心架構文件 (`architecture_summary.md`, `backend_workflow.md`) 進行了大規模的更新與統一，確保文件與當前系統狀態保持一致。
*   **當前版本**: 1.1.1